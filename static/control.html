<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <title>GHGH Judges Controls</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="colour.css">
</head>
<body>
<div class="container -full-height">

<h4 class="grey-darken-2">Connection status: <span class="red" id="status">Offline</span></h4>

<h1 class="title grey">GHGH Judge's Controls</h1>

<table class="button-table">
    <tr>
        <td><button class="trigger btn left orange-bk grey" data-id="t1">Orange Wins</button></td>
        <td><button class="trigger btn right blue-bk grey" data-id="t2">Blue Wins</button></td>
    </tr>
</table>

</div>

<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>
<script>
    function openConnection() {
        var conn = new WebSocket("ws://" + document.location.host + "/ws/control");

        conn.onopen = function() {
            $('#status').text("Online").removeClass().addClass("green");
        };
        conn.onclose = function() {
            $('#status').text("Offline").removeClass().addClass("red");
        };

        return conn;
    }

    $(document).ready(function() {
        var conn = openConnection();

        conn.onmessage = function(e) {
            var data = JSON.parse(e.data);

            switch(data['type']) {
                case "cmd":
                    var val = data['value'];
                    switch (val) {
                        case "reset":
                            $('body').removeClass();
                            data['type'] = 'ack';
                            conn.send(JSON.stringify(data));
                            $('.trigger').prop('disabled', false);
                            break;

                        default:
                            console.log("Unknown command: " + val);
                    }
                    break;

                case "ack":
                    var val = data['value'];
                    $('body').removeClass().addClass(val);
                    break;

                default:
                    console.log("Unknown message " + data)
            }
        };

        $('.trigger').on('click', function(e) {
            e.preventDefault();

            var id = $(this).data('id');

            var msg = JSON.stringify({
                type: 'cmd',
                value: id
            });

            conn.send(msg);

            $('.trigger').prop('disabled', true);
        });
    });
</script>
</body>
</html>